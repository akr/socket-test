#!/bin/sh

# Copyright (C) 2013 Tanaka Akira  <akr@fsij.org>
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions are met:
#
#  1. Redistributions of source code must retain the above copyright notice, this
#     list of conditions and the following disclaimer.
#  2. Redistributions in binary form must reproduce the above copyright notice,
#     this list of conditions and the following disclaimer in the documentation
#     and/or other materials provided with the distribution.
#  3. The name of the author may not be used to endorse or promote products
#     derived from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED
# WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
# MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
# EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT
# OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
# CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
# IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY
# OF SUCH DAMAGE.

exec 2>&1
set -v

./unix-dgram 'foo\0' 'foo\0' 'bar\0'
./unix-dgram 'foo' 'foo\0' 'bar\0'
./unix-dgram 'foo\0' 'foo' 'bar\0'
./unix-dgram 'foo\0' 'foo\0' 'bar'
./unix-dgram 'foo' 'foo' 'bar'

./unix-dgram 'foo\0' './foo\0' 'bar\0'
./unix-dgram 'foo' './foo\0' 'bar\0'
./unix-dgram 'foo\0' './foo' 'bar\0'
./unix-dgram 'foo\0' './foo\0' 'bar'
./unix-dgram 'foo' './foo' 'bar'

./unix-dgram '(44*"./")a'  '(44*"./")a'  'bar'
./unix-dgram '(44*"./")ab' '(44*"./")ab' 'bar'
./unix-dgram '(45*"./")a'  '(45*"./")a'  'bar'
./unix-dgram '(45*"./")ab' '(45*"./")ab' 'bar'
./unix-dgram '(46*"./")a'  '(46*"./")a'  'bar'
./unix-dgram '(46*"./")ab' '(46*"./")ab' 'bar'
./unix-dgram '(47*"./")a'  '(47*"./")a'  'bar'
./unix-dgram '(47*"./")ab' '(47*"./")ab' 'bar'
./unix-dgram '(48*"./")a'  '(48*"./")a'  'bar'
./unix-dgram '(48*"./")ab' '(48*"./")ab' 'bar'
./unix-dgram '(49*"./")a'  '(49*"./")a'  'bar'
./unix-dgram '(49*"./")ab' '(49*"./")ab' 'bar'

./unix-dgram '(50*"./")a'   '(50*"./")a'     'bar'
./unix-dgram '(50*"./")ab'  '(50*"./")ab'    'bar'
./unix-dgram '(51*"./")a'   '(51*"./")a'     'bar'
./unix-dgram '(51*"./")ab'  '(51*"./")ab'    'bar'
./unix-dgram '(52*"./")a'   '(52*"./")a'     'bar'
./unix-dgram '(52*"./")ab'  '(52*"./")ab'    'bar'
./unix-dgram '(53*"./")a'   '(53*"./")a'     'bar'
./unix-dgram '(53*"./")ab'  '(53*"./")ab'    'bar'
./unix-dgram '(54*"./")a'   '(54*"./")a'     'bar'
./unix-dgram '(54*"./")ab'  '(54*"./")ab'    'bar'
./unix-dgram '(55*"./")a'   '(55*"./")a'     'bar'
./unix-dgram '(55*"./")ab'  '(55*"./")ab'    'bar'
./unix-dgram '(56*"./")a'   '(56*"./")a'     'bar'
./unix-dgram '(56*"./")ab'  '(56*"./")ab'    'bar'
./unix-dgram '(57*"./")a'   '(57*"./")a'     'bar'
./unix-dgram '(57*"./")ab'  '(57*"./")ab'    'bar'
./unix-dgram '(58*"./")a'   '(58*"./")a'     'bar'
./unix-dgram '(58*"./")ab'  '(58*"./")ab'    'bar'
./unix-dgram '(59*"./")a'   '(59*"./")a'     'bar'
./unix-dgram '(59*"./")ab'  '(59*"./")ab'    'bar'
                                                  
./unix-dgram '(60*"./")a'   '(60*"./")a'     'bar'
./unix-dgram '(60*"./")ab'  '(60*"./")ab'    'bar'
./unix-dgram '(61*"./")a'   '(61*"./")a'     'bar'
./unix-dgram '(61*"./")ab'  '(61*"./")ab'    'bar'
./unix-dgram '(62*"./")a'   '(62*"./")a'     'bar'
./unix-dgram '(62*"./")ab'  '(62*"./")ab'    'bar'
./unix-dgram '(63*"./")a'   '(63*"./")a'     'bar'
./unix-dgram '(63*"./")ab'  '(63*"./")ab'    'bar'
./unix-dgram '(64*"./")a'   '(64*"./")a'     'bar'
./unix-dgram '(64*"./")ab'  '(64*"./")ab'    'bar'
./unix-dgram '(65*"./")a'   '(65*"./")a'     'bar'
./unix-dgram '(65*"./")ab'  '(65*"./")ab'    'bar'
./unix-dgram '(66*"./")a'   '(66*"./")a'     'bar'
./unix-dgram '(66*"./")ab'  '(66*"./")ab'    'bar'
./unix-dgram '(67*"./")a'   '(67*"./")a'     'bar'
./unix-dgram '(67*"./")ab'  '(67*"./")ab'    'bar'
./unix-dgram '(68*"./")a'   '(68*"./")a'     'bar'
./unix-dgram '(68*"./")ab'  '(68*"./")ab'    'bar'
./unix-dgram '(69*"./")a'   '(69*"./")a'     'bar'
./unix-dgram '(69*"./")ab'  '(69*"./")ab'    'bar'
                                                  
./unix-dgram '(120*"./")a'  '(120*"./")a'    'bar'
./unix-dgram '(120*"./")ab' '(120*"./")ab'   'bar'
./unix-dgram '(121*"./")a'  '(121*"./")a'    'bar'
./unix-dgram '(121*"./")ab' '(121*"./")ab'   'bar'
./unix-dgram '(122*"./")a'  '(122*"./")a'    'bar'
./unix-dgram '(122*"./")ab' '(122*"./")ab'   'bar'
./unix-dgram '(123*"./")a'  '(123*"./")a'    'bar'
./unix-dgram '(123*"./")ab' '(123*"./")ab'   'bar'
./unix-dgram '(124*"./")a'  '(124*"./")a'    'bar'
./unix-dgram '(124*"./")ab' '(124*"./")ab'   'bar'
./unix-dgram '(125*"./")a'  '(125*"./")a'    'bar'
./unix-dgram '(125*"./")ab' '(125*"./")ab'   'bar'
./unix-dgram '(126*"./")a'  '(126*"./")a'    'bar'
./unix-dgram '(126*"./")ab' '(126*"./")ab'   'bar'
./unix-dgram '(127*"./")a'  '(127*"./")a'    'bar'
./unix-dgram '(127*"./")ab' '(127*"./")ab'   'bar'
./unix-dgram '(128*"./")a'  '(128*"./")a'    'bar'
./unix-dgram '(128*"./")ab' '(128*"./")ab'   'bar'
./unix-dgram '(129*"./")a'  '(129*"./")a'    'bar'
./unix-dgram '(129*"./")ab' '(129*"./")ab'   'bar'
                                                  
./unix-dgram '(250*"./")a'  '(250*"./")a'    'bar'
./unix-dgram '(250*"./")ab' '(250*"./")ab'   'bar'
./unix-dgram '(251*"./")a'  '(251*"./")a'    'bar'
./unix-dgram '(251*"./")ab' '(251*"./")ab'   'bar'
./unix-dgram '(252*"./")a'  '(252*"./")a'    'bar'
./unix-dgram '(252*"./")ab' '(252*"./")ab'   'bar'
./unix-dgram '(253*"./")a'  '(253*"./")a'    'bar'
./unix-dgram '(253*"./")ab' '(253*"./")ab'   'bar'
./unix-dgram '(254*"./")a'  '(254*"./")a'    'bar'
./unix-dgram '(254*"./")ab' '(254*"./")ab'   'bar'
./unix-dgram '(255*"./")a'  '(255*"./")a'    'bar'
./unix-dgram '(255*"./")ab' '(255*"./")ab'   'bar'
./unix-dgram '(256*"./")a'  '(256*"./")a'    'bar'
./unix-dgram '(256*"./")ab' '(256*"./")ab'   'bar'
./unix-dgram '(257*"./")a'  '(257*"./")a'    'bar'
./unix-dgram '(257*"./")ab' '(257*"./")ab'   'bar'
./unix-dgram '(258*"./")a'  '(258*"./")a'    'bar'
./unix-dgram '(258*"./")ab' '(258*"./")ab'   'bar'
./unix-dgram '(259*"./")a'  '(259*"./")a'    'bar'
./unix-dgram '(259*"./")ab' '(259*"./")ab'   'bar'
                                                  
./unix-dgram '(510*"./")a'  '(510*"./")a'    'bar'
./unix-dgram '(510*"./")ab' '(510*"./")ab'   'bar'
./unix-dgram '(511*"./")a'  '(511*"./")a'    'bar'
./unix-dgram '(511*"./")ab' '(511*"./")ab'   'bar'
./unix-dgram '(512*"./")a'  '(512*"./")a'    'bar'
./unix-dgram '(512*"./")ab' '(512*"./")ab'   'bar'
./unix-dgram '(513*"./")a'  '(513*"./")a'    'bar'
./unix-dgram '(513*"./")ab' '(513*"./")ab'   'bar'
./unix-dgram '(514*"./")a'  '(514*"./")a'    'bar'
./unix-dgram '(514*"./")ab' '(514*"./")ab'   'bar'
./unix-dgram '(515*"./")a'  '(515*"./")a'    'bar'
./unix-dgram '(515*"./")ab' '(515*"./")ab'   'bar'
./unix-dgram '(516*"./")a'  '(516*"./")a'    'bar'
./unix-dgram '(516*"./")ab' '(516*"./")ab'   'bar'
./unix-dgram '(517*"./")a'  '(517*"./")a'    'bar'
./unix-dgram '(517*"./")ab' '(517*"./")ab'   'bar'
./unix-dgram '(518*"./")a'  '(518*"./")a'    'bar'
./unix-dgram '(518*"./")ab' '(518*"./")ab'   'bar'
./unix-dgram '(519*"./")a'  '(519*"./")a'    'bar'
./unix-dgram '(519*"./")ab' '(519*"./")ab'   'bar'

./unix-dgram '(90*"c")'  '(90*"c")'  'bar'
./unix-dgram '(91*"c")'  '(91*"c")'  'bar'
./unix-dgram '(92*"c")'  '(92*"c")'  'bar'
./unix-dgram '(93*"c")'  '(93*"c")'  'bar'
./unix-dgram '(94*"c")'  '(94*"c")'  'bar'
./unix-dgram '(95*"c")'  '(95*"c")'  'bar'
./unix-dgram '(96*"c")'  '(96*"c")'  'bar'
./unix-dgram '(97*"c")'  '(97*"c")'  'bar'
./unix-dgram '(98*"c")'  '(98*"c")'  'bar'
./unix-dgram '(99*"c")'  '(99*"c")'  'bar'
                                         
./unix-dgram '(100*"c")' '(100*"c")' 'bar'
./unix-dgram '(101*"c")' '(101*"c")' 'bar'
./unix-dgram '(102*"c")' '(102*"c")' 'bar'
./unix-dgram '(103*"c")' '(103*"c")' 'bar'
./unix-dgram '(104*"c")' '(104*"c")' 'bar'
./unix-dgram '(105*"c")' '(105*"c")' 'bar'
./unix-dgram '(106*"c")' '(106*"c")' 'bar'
./unix-dgram '(107*"c")' '(107*"c")' 'bar'
./unix-dgram '(108*"c")' '(108*"c")' 'bar'
./unix-dgram '(109*"c")' '(109*"c")' 'bar'
                                         
./unix-dgram '(110*"c")' '(110*"c")' 'bar'
./unix-dgram '(111*"c")' '(111*"c")' 'bar'
./unix-dgram '(112*"c")' '(112*"c")' 'bar'
./unix-dgram '(113*"c")' '(113*"c")' 'bar'
./unix-dgram '(114*"c")' '(114*"c")' 'bar'
./unix-dgram '(115*"c")' '(115*"c")' 'bar'
./unix-dgram '(116*"c")' '(116*"c")' 'bar'
./unix-dgram '(117*"c")' '(117*"c")' 'bar'
./unix-dgram '(118*"c")' '(118*"c")' 'bar'
./unix-dgram '(119*"c")' '(119*"c")' 'bar'
                                         
./unix-dgram '(120*"c")' '(120*"c")' 'bar'
./unix-dgram '(121*"c")' '(121*"c")' 'bar'
./unix-dgram '(122*"c")' '(122*"c")' 'bar'
./unix-dgram '(123*"c")' '(123*"c")' 'bar'
./unix-dgram '(124*"c")' '(124*"c")' 'bar'
./unix-dgram '(125*"c")' '(125*"c")' 'bar'
./unix-dgram '(126*"c")' '(126*"c")' 'bar'
./unix-dgram '(127*"c")' '(127*"c")' 'bar'
./unix-dgram '(128*"c")' '(128*"c")' 'bar'
./unix-dgram '(129*"c")' '(129*"c")' 'bar'
                                         
./unix-dgram '(250*"c")' '(250*"c")' 'bar'
./unix-dgram '(251*"c")' '(251*"c")' 'bar'
./unix-dgram '(252*"c")' '(252*"c")' 'bar'
./unix-dgram '(253*"c")' '(253*"c")' 'bar'
./unix-dgram '(254*"c")' '(254*"c")' 'bar'
./unix-dgram '(255*"c")' '(255*"c")' 'bar'
./unix-dgram '(256*"c")' '(256*"c")' 'bar'
./unix-dgram '(257*"c")' '(257*"c")' 'bar'
./unix-dgram '(258*"c")' '(258*"c")' 'bar'
./unix-dgram '(259*"c")' '(259*"c")' 'bar'

./unix-dgram -p '01234567'    '01234567'    'bar'
./unix-dgram -p '012345678'   '012345678'   'bar'
./unix-dgram -p '0123456789'  '0123456789'  'bar'
./unix-dgram -p '01234567890' '01234567890' 'bar'
        
./unix-dgram -g2048 -p '01234567890' '01234567890' 'bar'
./unix-dgram -g2048 -p 'foo' 'foo' '01234567890'

./unix-dgram -g255 '(115*"./")ab' '(115*"./")ab' 'bar'
./unix-dgram -g255 '(116*"./")a' '(116*"./")a' 'bar'
./unix-dgram -g255 '(116*"./")ab' '(116*"./")ab' 'bar'
./unix-dgram -g255 '(117*"./")a' '(117*"./")a' 'bar'
./unix-dgram -g255 '(117*"./")ab' '(117*"./")ab' 'bar'
./unix-dgram -g255 '(118*"./")a' '(118*"./")a' 'bar'
./unix-dgram -g255 '(118*"./")ab' '(118*"./")ab' 'bar'
./unix-dgram -g255 '(119*"./")a' '(119*"./")a' 'bar'
./unix-dgram -g255 '(119*"./")ab' '(119*"./")ab' 'bar'
./unix-dgram -g255 '(120*"./")a' '(120*"./")a' 'bar'
./unix-dgram -g255 '(120*"./")ab' '(120*"./")ab' 'bar'
./unix-dgram -g255 '(121*"./")a' '(121*"./")a' 'bar'
./unix-dgram -g255 '(121*"./")ab' '(121*"./")ab' 'bar'
./unix-dgram -g255 '(122*"./")a' '(122*"./")a' 'bar'
./unix-dgram -g255 '(122*"./")ab' '(122*"./")ab' 'bar'
./unix-dgram -g255 '(123*"./")a' '(123*"./")a' 'bar'
./unix-dgram -g255 '(123*"./")ab' '(123*"./")ab' 'bar'
./unix-dgram -g255 '(124*"./")a' '(124*"./")a' 'bar'
./unix-dgram -g255 '(124*"./")ab' '(124*"./")ab' 'bar'
./unix-dgram -g255 '(125*"./")a' '(125*"./")a' 'bar'
./unix-dgram -g255 '(125*"./")ab' '(125*"./")ab' 'bar'
./unix-dgram -g255 '(126*"./")a' '(126*"./")a' 'bar'
./unix-dgram -g1026 '(511*"./")a' '(511*"./")a' 'bar'
./unix-dgram -g1026 '(511*"./")ab' '(511*"./")ab' 'bar'

./unix-dgram 'foo' 'foo' '(125*"./")ab'
./unix-dgram 'foo' 'foo' '(126*"./")a'
./unix-dgram 'foo' 'foo' '(511*"./")a'
./unix-dgram 'foo' 'foo' '(511*"./")ab'
./unix-dgram -g255 'foo' 'foo' '(125*"./")ab'
./unix-dgram -g1026 'foo' 'foo' '(511*"./")a'

./unix-dgram -s ''    
./unix-dgram -s '.'   
./unix-dgram -s '/'   
./unix-dgram -s '/foo'        
./unix-dgram -s '/foo/bar'    
./unix-dgram -s '/etc'        
./unix-dgram -T -s 'README'   

